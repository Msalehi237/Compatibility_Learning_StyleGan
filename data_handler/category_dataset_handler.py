# -*- coding: utf-8 -*-
"""Untitled20.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ScZcNfJuh_ob_u2j6G70ZYK7jSdHGA7e
"""

import json
import pandas as pd
import numpy as np
from tqdm import tqdm

with open('/content/polyvore_item_metadata.json', 'r') as f:
    data = json.load(f)
meta = pd.DataFrame(data)
meta=meta.T
with open('/content/polyvore_outfit_titles.json', 'r') as f:
    data = json.load(f)
outfit_titles = pd.DataFrame(data)
outfit_titles=outfit_titles.T
with open('/content/train.json', 'r') as f:
    data = json.load(f)
train_json = pd.DataFrame(data)
train_json=train_json

with open('/content/compatibility_train.txt', 'r') as f:
  lines  = f.readlines()

compatibility_questions = []
for line in lines:
  data = line.strip().split()
  compat_question= data[1:]
  compatibility_questions.append((compat_question, str(data[0])))

cat_id_training_set=pd.DataFrame(np.zeros((len(compatibility_questions),17)),dtype=int)
cat_id_training_set.rename(columns={0: "Target"},inplace=True)

for index,question in tqdm(enumerate(compatibility_questions)): 
  
  cat_id_training_set['Target'][index] = question[-1]
  ll = question[0]
  temp_set_id=0
  temp_set=0
  for index2,quest in enumerate(ll):
    set_id = quest.split("_")[0]
    item_index = quest.split("_")[1]

    if set_id == temp_set_id:
      item_id = temp_set[int(item_index)-1]['item_id']
      
    else:
      temp_set_id=set_id
      temp_set = train_json[train_json['set_id']==set_id].values[0][0]
      item_id = temp_set[int(item_index)-1]['item_id']
    
    cat_id_training_set[index2+1][index] = meta[meta.index==item_id]['category_id'].values[0]

cat_id_training_set.to_csv('cat_id_training_set.csv',index=False)

